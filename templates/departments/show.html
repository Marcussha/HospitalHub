{% extends 'base.html' %}

{% block title %}Departments{% endblock title %}

{% block content %}
<form id="search-form" method="GET" action="{% url 'departments_search' %}">
    <input type="text" name="q" placeholder="Search departments">
    <button type="submit">Search</button>
</form>
<div class="col-md-12">
    {% if is_admin or is_manager %}
        <span><a href="/departments/addnew" class="btn btn-primary">Add New Record</a></span>
    {% endif %}
    <div class="table-responsive">
        <table id="bootstrapdatatable" class="table table-striped table-bordered" width="100%">
            <thead>
                <th>Department ID</th>
                <th>Name Department</th>
                {% if is_admin %}
                    <th>Edit</th>
                    <th>Delete</th>
                {% endif %}
            </thead>
            <tbody>
                {% for department in departments %}
                    <tr>
                        <td>{{ department.departmentid }}</td>
                        <td>{{ department.named }}</td>
                        {% if is_admin %}
                            <td><a href="departments/edit/{{ department.departmentid }}" class="btn btn-info">Edit</a></td>
                            <td><a href="departments/delete/{{ department.departmentid }}" class="btn btn-danger">Delete</a></td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function () {
        $('#search-form').submit(function (event) {
            event.preventDefault(); // Prevent the form from submitting normally
            var query = $('input[name="q"]').val();
    
            $.ajax({
                url: $(this).attr('action'), // Use the form's action URL
                type: 'GET',
                data: { 'q': query },
                success: function (data) {
                    $('#search-results').html(data);
                }
            });
        });
    });
    </script>
{% endblock content %}
